package org.penforge.backend.statistics;

import lombok.Data;
import lombok.AllArgsConstructor;
import org.penforge.backend.pentestReport.PentestReportRepository;
import org.springframework.stereotype.Service;
import org.penforge.backend.pentestReport.PentestReport;

import java.util.List;

@Service // Bu s覺n覺f覺 Spring bean'i olarak tan覺mlar
@Data
@AllArgsConstructor
public class PentestStatisticsService {

    private final PentestReportRepository pentestReportRepository;

    public StatisticsData calculateStatistics(String userId) {

        List<PentestReport> reports = pentestReportRepository.findAllByUserId(userId)
                .orElse(List.of());

        int totalTargets = reports.size();
        int vulnerableTargets = (int) reports.stream()
                .filter(report -> !report.getCredentials().isEmpty())
                .count();
        int totalOpenPorts = reports.stream()
                .mapToInt(report -> report.getPortData().size())
                .sum();
        int totalTests = totalTargets;

        return new StatisticsData(totalTargets, vulnerableTargets, totalOpenPorts, totalTests);
    }


}
